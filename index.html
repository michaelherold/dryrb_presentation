<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>dryrb - Single purpose libraries for the Rubyist soul</title>
    <link rel="stylesheet" type="text/css" href="build/build.css">
  </head>
  <body>
    <article>
      <section data-bespoke-hash="title">
        <h1>dry-rb</h1>
        <h3>Single purpose libraries for the Rubyist soul</h3>
      </section>
      <section data-bespoke-hash="utility-gems">
        <h2>Utility Gems</h2>
        <ul data-bespoke-bullet>
          <li data-bespoke-bullet>dry-equalizer: Object equal testing</li>
          <li data-bespoke-bullet>dry-result_matcher: Pattern matching</li>
          <li data-bespoke-bullet>dry-transaction: Railway programming for business logic</li>
        </ul>
      </section>
      <section data-bespoke-hash="dependency-gems">
        <h2>Dependency Management Gems</h2>
        <ul data-bespoke-bullet>
          <li data-bespoke-bullet>dry-container: IoC container</li>
          <li data-bespoke-bullet>dry-auto_inject: Automatic dependency injection</li>
          <li data-bespoke-bullet>dry-component: Dependency management system</li>
        </ul>
      </section>
      <section data-bespoke-hash="data-gems">
        <h2>Data Gems</h2>
        <ul data-bespoke-bullet>
          <li data-bespoke-bullet>dry-logic: Predicate logic</li>
          <li data-bespoke-bullet>dry-types: Flexible type system</li>
          <li data-bespoke-bullet>dry-validation: Predicate-based data validation</li>
        </ul>
      </section>
      <section data-bespoke-hash="our-focus">
        <h2>Our focus for today</h2>
        <ul data-bespoke-bullet>
          <li data-bespoke-bullet>dry-types</li>
          <li data-bespoke-bullet>dry-validation</li>
        </ul>
      </section>
      <section data-bespoke-hash="dry-types">
        <h2>dry-types</h2>
        <p>Flexible type system with many built-in types</p>
      </section>
      <section data-bespoke-hash="dry-types-built-ins-base">
        <h2>dry-types: Built-in Types</h2>
        <h3>Base Types</h3>
        <pre><code class="language-ruby">Types::Array    Types::Bool       Types::Class
Types::Date     Types::DateTime   Types::Hash
Types::Nil      Types::Symbol     Types::Time
</code></pre>
      </section>
      <section data-bespoke-hash="dry-types-builtins-strict">
        <h2>dry-types: Built-in Types</h2>
        <h3>Strict Types (with primitive type check)</h3>
        <pre><code class="language-ruby">Types::Strict::Array      #=> Array
Types::Strict::Decimal    #=> BigDecimal
Types::Strict::Float      #=> Float
Types::Strict::Hash       #=> Hash
Types::Strict::Int        #=> Integer
Types::Strict::String     #=> String
</code></pre>
      </section>
      <section data-bespoke-hash="dry-types-builtins-coercible">
        <h2>dry-types: Built-in Types</h2>
        <h3>Coercible Types (via Kernel coercion)</h3>
        <pre><code class="language-ruby">Types::Coercible::Array[1]        #=> [1]
Types::Coercible::Decimal[1]      #=> BigDecimal('1.0')
Types::Coercible::Float[1]        #=> 1.0
Types::Coercible::Hash[nil]       #=> {}
Types::Coercible::Int["1"]        #=> 1
Types::Coercible::String[1]       #=> "1"
</code></pre>
      </section>
      <section data-bespoke-hash="dry-types-builtins-form">
        <h2>dry-types: Built-in Types</h2>
        <h3>Form Types (for params objects)</h3>
        <pre><code class="language-ruby">Types::Form::DateTime["2016-04-14T18:00:00-05:00"]

Types::Form::Bool["t"]    #=> true
Types::Form::Bool["1"]    #=> true
Types::Form::Bool["f"]    #=> false
Types::Form::Bool["0"]    #=> false
</code></pre>
      </section>
      <section data-bespoke-hash="dry-types-builtins-maybe">
        <h2>dry-types: Built-in Types</h2>
        <h3>Maybe Types (Monads!)</h3>
        <pre><code class="language-ruby">Types::Maybe::Coercible::String[:wat]   #=> Some("wat")
Types::Maybe::Coercible::String[nil]    #=> None

Types::Maybe::Strict::String[:wat]      #=> ConstraintError
Types::Maybe::Strict::String[nil]       #=> None
</code></pre>
      </section>
      <section data-bespoke-hash="dry-types-defining-types-defaults">
        <h2>dry-types: Defining Types</h2>
        <h3>Default Values</h3>
        <pre><code class="language-ruby">LastName = Types::Strict::String.default("Awesome")

LastName[nil]           #=> "Awesome"
LastName[""]            #=> "Awesome"
LastName["Matsumoto"]   #=> "Matsumoto"
</code></pre>
      </section>
      <section data-bespoke-hash="dry-types-defining-types-constraints">
        <h2>dry-types: Defining Types</h2>
        <h3>Constraints</h3>
        <pre><code class="language-ruby">HexColor = Types::Strict::String.constrained(
  format: /\A\#(?:[\da-f]{6}|[\da-f]{3})\z/i
)

HexColor["#fff"]        #=> "#fff"
HexColor["#e5e5e5"]     #=> "#e5e5e5"
HexColor["#1234"]       #=> ConstraintError
</code></pre>
      </section>
      <section data-bespoke-hash="dry-types-defining-types-sum">
        <h2>dry-types: Defining Types</h2>
        <h3>Sum Types</h3>
        <pre><code class="language-ruby">HexColor = Types::Strict::String.constrained(...)
RgbColor = Types::Strict::String.constrained(...)
Color = HexColor | RgbColor

Color["#fff"]                   #=> "#fff"
Color["rgb(239, 239, 239)"]     #=> "rgb(239, 239, 239)"
Color["not a color"]            #=> ConstraintError
</code></pre>
      </section>
      <section data-bespoke-hash="dry-types-structs">
        <h2>dry-types: Structs</h2>
        <pre><code class="language-ruby">class User < Dry::Types::Struct
  attribute :age,   Types::Coercible::Int
  attribute :color, Color
  attribute :name,  Types::Maybe::Coercible::String
end

user = User.new(name: nil, age: "29", color: "#ff0")
user.name             #=> None
user.age              #=> 29
user.favorite_color   #=> "#ff0"
</code></pre>
      </section>
      <section data-bespoke-hash="dry-types-values">
        <h2>dry-types: Value Objects</h2>
        <pre><code class="language-ruby">class Point < Dry::Types::Value
  attribute :x, Types::Coercible::Int
  attribute :y, Types::Coercible::Int
end

origin = Point.new(x: 0, y: 0)
string_origin = Point.new(x: "0", y: "0")

origin == string_origin   #=> true
</code></pre>
      </section>
      <section data-bespoke-hash="dry-types-misc">
        <h2>dry-types: Extras</h2>
        <h3>Enums, Hash schemas, and Array members</h3>
        <pre><code class="language-ruby">PostStatus = Types::Strict::String.enum("draft", "published")
PostStatuses = Types::Strict::Array.member(PostStatus)
PostParams = Types::Hash.schema(
  title: Types::String,
  published_on: Types::DateTime,
  status: PostStatus
)
</code></pre>
      </section>
      <section data-bespoke-hash="dry-types-wrap-up">
        <h2>dry-types: Wrap up</h2>
        <ul data-bespoke-bullet>
          <li data-bespoke-bullet>Flexible type system</li>
          <li data-bespoke-bullet>Handles strict input an coercible input</li>
          <li data-bespoke-bullet>Extremely fast!</li>
        </ul>
      </section>
      <section data-bespoke-hash="dry-validation">
        <h2>dry-validation</h2>
        <p>Predicate-based data validation</p>
      </section>
      <section data-bespoke-hash="dry-validation-schema">
        <h2>dry-validation: Schemas</h2>
        <pre><code class="language-ruby">PostSchema = Dry::Validation.Schema do
  key(:title).required
  key(:status).required(inclusion?: ["draft", "published"])
end

PostSchema.(title: "Test Post", status: "draft").success? #=> true
PostSchema.(title: "Test Post", status: "other").success? #=> false
PostSchema.(title: "Test Post").success? #=> false
</code></pre>
      </section>
      <section data-bespoke-hash="dry-validation-builtin-predicates">
        <h2>dry-validation: Built-In Predicates</h2>
        <pre><code class="language-ruby">:empty?   :eql?   :filled?  :format?
:gt?      :gteq?  :key?     :lt?
:lteq?    :none?  :type?

:inclusion?     :exclusion?
:max_size?      :min_size?
:size?(int)     :size?(range)
</code></pre>
      </section>
      <section data-bespoke-hash="dry-validation-custom-predicates">
        <h2>dry-validation: Custom Predicates</h2>
        <pre><code class="language-ruby">module PostPredicates
  include Dry::Logic::Predicates
  predicate(:status?) { inclusion?(%w(draft published)) }
end
PostSchema = Dry::Validation.Schema do
  configure { config.predicates = PostPredicates }
  key(:status).required(&:status?)
end
</code></pre>
      </section>
      <section data-bespoke-hash="dry-validation-messages">
        <h2>dry-validation: Messages</h2>
        <pre><code class="language-ruby">PostSchema.(title: "Test Post", status: "other").messages
#=> {:status => ["must be one of: draft, published"]}

PostSchema.(status: "").messages(full: true)
#=> {:title  => ["title is missing"],
#=>  :status => ["status must be filled",
#=>              "status must be one of: draft, published"]}</code></pre>
        <p>The same format as ActiveModel::Model</p>
      </section>
      <section data-bespoke-hash="dry-validation-custom-messages">
        <h2>dry-validation: Custom Messages</h2>
        <pre><code class="language-ruby">UserSchema = Dry::Validation.Schema do
  configure do
    config.messages      = :i18n
    config.messages_file = "some/yaml/error.yml"
    config.namespace     = :user
  end
end
</code></pre>
      </section>
      <section data-bespoke-hash="dry-validation-optionals">
        <h2>dry-validation: Optionals</h2>
        <pre><code class="language-ruby">PersonSchema = Dry::Validation.Schema do
  optional(:name).maybe(:str?)
  optional(:first_name).maybe(:str?)
  optional(:last_name).maybe(:str?)
end
</code></pre>
      </section>
      <section data-bespoke-hash="dry-validation-rules">
        <h2>dry-validation: Composite Rules</h2>
        <pre><code class="language-ruby">PersonSchema = Dry::Validation.Schema do
  # ...
  rule(migrate_name: [:name, :first_name, :last_name]) do
    |name, fname, lname|
    
    (name.filled? & (fname.none? & lname.none?)) |
    (name.none? & (fname.filled? & lname.filled?))
  end
end
</code></pre>
      </section>
      <section data-bespoke-hash="dry-validation-wrap-up">
        <h2>dry-validation: Wrap Up</h2>
        <ul data-bespoke-bullet>
          <li data-bespoke-bullet>Very expressive</li>
          <li data-bespoke-bullet>Extensible</li>
          <li data-bespoke-bullet>Sadly no direct integration to dry-types?</li>
        </ul>
      </section>
      <section data-bespoke-hash="interactor-without-checking">
        <h2>Interactors - Without Checking</h2>
        <pre><code class="language-ruby">class CreateUser
  include Interactor
  
  def call
    context.user = User.create!(
      name: context.name,
      email: context.email
    )
  end
end
</code></pre>
      </section>
      <section data-bespoke-hash="interactor-repetitive-checking">
        <h2>Repetitive Checking</h2>
        <pre><code class="language-ruby">class CreateUser
  before do
    %i(email name).each do |attr|
      unless context[attr].present?
        context.fail!(message: "missing_#{attr}")
      end
    end
  end
end
</code></pre>
      </section>
      <section data-bespoke-hash="interactor-contracts-expectations">
        <h2>interactor-contracts</h2>
        <p>Expectations</p>
        <pre><code class="language-ruby">class CreateUser
  include Interactor::Contracts
  
  expects do
    attr(:email, &:filled?)
    attr(:name, &:filled?)
  end
end
</code></pre>
      </section>
      <section data-bespoke-hash="interactor-contracts-assurances">
        <h2>interactor-contracts</h2>
        <p>Assurances</p>
        <pre><code class="language-ruby">class CreateUser
  include Interactor::Contracts
  
  assures do
    attr(:user, &:filled?)
  end
end
</code></pre>
      </section>
      <section data-bespoke-hash="interactor-contracts-future-work">
        <h2>interactor-contracts</h2>
        <h3>Future Work</h3>
        <ul data-bespoke-bullet>
          <li data-bespoke-bullet>Reuse schemas between interactors</li>
          <li data-bespoke-bullet>Check long business logic chains at startup</li>
          <li data-bespoke-bullet>Integrate dry-type checking</li>
        </ul>
      </section>
      <section data-bespoke-backdrop="emphatic" data-bespoke-hash="end" class="emphatic-text">
        <p><b>Presentation available at:</b></p>
        <p><a href="https://michaelherold.github.io/dryrb_presentation" target="_blank">https://michaelherold.github.io/dryrb_presentation</a></p>
        <p><b>Want to chat?</b></p>
        <ul class="contact-list">
          <li><i class="fa fa-fw fa-envelope"></i><a href="mailto:michael.j.herold@gmail.com">michael.j.herold@gmail.com</a></li>
          <li><i class="fa fa-fw fa-github"></i><a href="https://github.com/michaelherold">michaelherold</a></li>
          <li><i class="fa fa-fw fa-twitter"></i><a href="https://twitter.com/mherold">mherold</a></li>
        </ul>
      </section>
    </article>
    <script src="build/build.js"></script>
  </body>
</html>